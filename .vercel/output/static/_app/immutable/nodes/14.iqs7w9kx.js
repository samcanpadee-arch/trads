import{f as k,a as w}from"../chunks/DbI-BAT7.js";import"../chunks/eNEize8k.js";import{p as Jt,l as R,o as Lt,t as F,c as s,h as t,a as Qt,$ as Wt,s as i,q as m,m as u,g as c,r as e,v as A,f as zt,b as Et}from"../chunks/DpahKekj.js";import{s as v}from"../chunks/VvQGwHW7.js";import{i as V}from"../chunks/btn1nWV7.js";import{e as Ht,i as Kt}from"../chunks/B9aOS7PH.js";import{h as Vt}from"../chunks/CY1QkmDl.js";import{r as M}from"../chunks/DF0FGNug.js";import{e as X}from"../chunks/BoqBtSLs.js";import{b as T}from"../chunks/CiKuUkrW.js";import{b as Xt}from"../chunks/Cm5o7Fn9.js";var Yt=k('<td class="text-right"> </td> <td class="text-right"> </td> <td class="text-right font-semibold"> </td>',1),Zt=k('<td class="text-right">—</td><td class="text-right">—</td><td class="text-right">—</td>',1),ta=k('<button class="btn btn-ghost btn-xs">Remove</button>'),aa=k('<tr><td class="min-w-[12rem]"><input class="input input-bordered input-sm w-full" placeholder="e.g. 2.5mm TPS Cable"/></td><td class="min-w-[8rem] text-right"><input id="markupPct" type="number" min="0" step="0.01" class="input input-bordered input-sm text-right w-28"/></td><td class="min-w-[6rem] text-right"><input id="markupPct" type="number" min="0" step="0.01" class="input input-bordered input-sm text-right w-20"/></td><td class="min-w-[6rem] text-right"><input id="markupPct" type="number" min="0" max="100" step="0.1" class="input input-bordered input-sm text-right w-24"/></td><!><td class="text-right"><!></td></tr>'),ea=k('<div class="prose max-w-none mt-3 whitespace-pre-wrap"> </div>'),sa=k(`<div class="max-w-5xl mx-auto p-4 space-y-6"><div class="flex items-center justify-between"><h1 class="text-2xl font-bold">Material & Cost Calculator</h1> <div class="flex items-center gap-3"><div class="form-control"><label class="label" for="markupPct"><span class="label-text">Markup % (profit)</span></label> <input id="markupPct" type="number" class="input input-bordered input-sm w-28" min="0" step="0.1"/></div> <div class="form-control"><label class="label" for="currencySel"><span class="label-text">Currency</span></label> <select id="currencySel" class="select select-bordered select-sm w-28"><option>AUD</option></select></div></div></div> <div class="card bg-base-100 border"><div class="card-body"><div class="overflow-x-auto"><table class="table"><thead><tr><th>Material</th><th class="text-right">Unit Cost</th><th class="text-right">Qty</th><th class="text-right">Trade Disc. %</th><th class="text-right">Before</th><th class="text-right">Discount</th><th class="text-right">Subtotal</th><th></th></tr></thead><tbody></tbody></table></div> <div class="flex justify-between items-center pt-4"><button class="btn btn-outline btn-sm">+ Add Material</button> <div class="text-right space-y-1"><div>Total materials: <span class="font-semibold"> </span></div> <div> <span class="font-semibold"> </span></div> <div class="text-lg">Final total: <span class="font-bold"> </span></div></div></div></div></div> <div class="card bg-base-100 border"><div class="card-body"><div class="flex items-center justify-between"><h2 class="card-title">Generate AI Summary</h2> <button class="btn btn-primary btn-sm"> </button></div> <p class="text-sm opacity-70">We calculate totals deterministically. If an OpenAI key is configured, we’ll create a clean, client-ready
        summary including itemised costs, discounts, profit and final price.</p> <!></div></div></div>`);function ba(gt,wt){Jt(wt,!1);const d=u(),p=u(),P=u(),G=u();let l=u([{name:"",unitCost:0,quantity:1,discountPct:0}]),f=u(20),C=u("AUD"),j=u(!1),_=u("");function kt(){c(l,[...t(l),{name:"",unitCost:0,quantity:1,discountPct:0}])}function Pt(a){c(l,t(l).filter((r,o)=>o!==a))}const S=a=>{const r=parseFloat(a);return Number.isFinite(r)?r:0},Y=(a,r,o)=>Math.min(o,Math.max(r,a)),h=a=>a.toLocaleString(void 0,{style:"currency",currency:t(C)});async function Ct(){c(j,!0),c(_,"");try{const a=await fetch("/api/material-cost",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t(l),markupPercent:S(t(f)),currency:t(C)})});if(!a.ok){c(_,"Server error: "+await a.text());return}const r=await a.json();c(_,r.summary??"")}catch(a){c(_,"Request failed: "+((a==null?void 0:a.message)||a))}finally{c(j,!1)}}R(()=>t(l),()=>{c(d,t(l).map(a=>{const r=S(a.unitCost),o=Y(S(a.quantity),0,1e9),x=Y(S(a.discountPct),0,100),y=r*(1-x/100),q=r*o,g=y*o,U=q-g;return{...a,unit:r,qty:o,disc:x,discountedUnit:y,before:q,discountAmount:U,subtotal:g}}))}),R(()=>t(d),()=>{c(p,t(d).reduce((a,r)=>a+r.subtotal,0))}),R(()=>(t(p),t(f)),()=>{c(P,t(p)*(S(t(f))/100))}),R(()=>(t(p),t(P)),()=>{c(G,t(p)+t(P))}),Lt();var I=sa();Vt(a=>{Wt.title="Material & Cost Calculator"});var O=s(I),Z=i(s(O),2),$=s(Z),tt=i(s($),2);M(tt),e($);var at=i($,2),N=i(s(at),2);F(()=>{t(C),A(()=>{})});var et=s(N);et.value=et.__value="AUD",e(N),e(at),e(Z),e(O);var B=i(O,2),st=s(B),J=s(st),rt=s(J),it=i(s(rt));Ht(it,5,()=>t(l),Kt,(a,r,o)=>{var x=aa(),y=s(x),q=s(y);M(q),e(y);var g=i(y),U=s(g);M(U),e(g);var z=i(g),ft=s(z);M(ft),e(z);var E=i(z),_t=s(E);M(_t),e(E);var ht=i(E);{var Dt=n=>{var b=Yt(),H=zt(b),Gt=s(H,!0);e(H);var K=i(H,2),It=s(K,!0);e(K);var yt=i(K,2),Ot=s(yt,!0);e(yt),F(($t,Nt,Bt)=>{v(Gt,$t),v(It,Nt),v(Ot,Bt)},[()=>(t(d),m(()=>h(t(d)[o].before))),()=>(t(d),m(()=>h(t(d)[o].discountAmount))),()=>(t(d),m(()=>h(t(d)[o].subtotal)))]),w(n,b)},Ut=n=>{var b=Zt();Et(2),w(n,b)};V(ht,n=>{t(d),m(()=>t(d)[o])?n(Dt):n(Ut,!1)})}var xt=i(ht),Rt=s(xt);{var Ft=n=>{var b=ta();X("click",b,()=>Pt(o)),w(n,b)};V(Rt,n=>{t(l),m(()=>t(l).length>1)&&n(Ft)})}e(xt),e(x),T(q,()=>t(r).name,n=>(t(r).name=n,A(()=>t(l)))),T(U,()=>t(r).unitCost,n=>(t(r).unitCost=n,A(()=>t(l)))),T(ft,()=>t(r).quantity,n=>(t(r).quantity=n,A(()=>t(l)))),T(_t,()=>t(r).discountPct,n=>(t(r).discountPct=n,A(()=>t(l)))),w(a,x)}),e(it),e(rt),e(J);var nt=i(J,2),ot=s(nt),lt=i(ot,2),L=s(lt),ct=i(s(L)),St=s(ct,!0);e(ct),e(L);var Q=i(L,2),dt=s(Q),ut=i(dt),qt=s(ut,!0);e(ut),e(Q);var vt=i(Q,2),mt=i(s(vt)),At=s(mt,!0);e(mt),e(vt),e(lt),e(nt),e(st),e(B);var pt=i(B,2),bt=s(pt),W=s(bt),D=i(s(W),2),Mt=s(D,!0);e(D),e(W);var Tt=i(W,4);{var jt=a=>{var r=ea(),o=s(r,!0);e(r),F(()=>v(o,t(_))),w(a,r)};V(Tt,a=>{t(_)&&a(jt)})}e(bt),e(pt),e(I),F((a,r,o)=>{v(St,a),v(dt,`Profit (${t(f)??""}%): `),v(qt,r),v(At,o),D.disabled=t(j),v(Mt,t(j)?"Generating…":"Generate")},[()=>(t(p),m(()=>h(t(p)))),()=>(t(P),m(()=>h(t(P)))),()=>(t(G),m(()=>h(t(G))))]),T(tt,()=>t(f),a=>c(f,a)),Xt(N,()=>t(C),a=>c(C,a)),X("click",ot,kt),X("click",D,Ct),w(gt,I),Qt()}export{ba as component};
